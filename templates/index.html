<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>BookGenie | Your Reading Companion</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
</head>

<body>

<!-- ================= NAVBAR ================= -->
<nav class="glass-nav">
    <div class="nav-content">

        <a href="/" class="logo">‚ú® Book<span>Genie</span></a>

        <form action="/search" method="GET" class="search-container">
            <input type="text" name="q"
                   placeholder="Search for your next adventure..."
                   value="{{ request.args.get('q', '') }}">
            <button type="submit">üîç</button>
        </form>

        <div class="nav-actions">

            <!-- CART -->
            <div class="cart-btn" onclick="window.location.href='/cart'">
                üõí <span id="cartCount">0</span>
            </div>

            {% if session.get("user") %}
                <div class="user-pill">üëã Hi, {{ session["user"] }}</div>
                <a href="/logout" class="login-pill">Logout</a>
            {% else %}
                <div class="guest-pill">üü¢ Guest Mode</div>
                <a href="/login" class="login-pill">Login</a>
                <a href="/signup" class="signup-pill">Signup</a>
            {% endif %}

        </div>
    </div>
</nav>

<!-- ================= HERO ================= -->
<header class="hero-section">
    <div class="hero-content">

        <div class="hero-text">
            {% if session.get("user") %}
                <h1>Welcome Back, <span>{{ session["user"] }}</span> üëã</h1>
            {% else %}
                <h1>Wish for a Book,<br><span>Genie</span> Delivers.</h1>
                <p class="guest-note">‚ö° Guest users can browse & add to cart. Login required to buy.</p>
            {% endif %}
            <p>Curated collections of stories that spark magic in your everyday life.</p>
        </div>

        <!-- FILTER CARD -->
        <div class="hero-card">
            <h3>Find Your Perfect Book</h3>

            <div class="filter-group">
                <label>Book Title</label>
                <input type="text" id="filterTitle" placeholder="Enter title..." oninput="dynamicFilter()">
            </div>

            <div class="filter-group">
                <label>Author</label>
                <input type="text" id="filterAuthor" placeholder="Enter author..." oninput="dynamicFilter()">
            </div>

            <div class="filter-group">
                <label>Year</label>
                <input type="text" id="filterYear" placeholder="e.g. 2002" oninput="dynamicFilter()">
            </div>

            <div class="filter-group">
                <label>Publisher</label>
                <input type="text" id="filterPublisher" placeholder="Enter publisher..." oninput="dynamicFilter()">
            </div>

        </div>
    </div>
</header>

<!-- ================= MAIN ================= -->
<main>

    <div class="grid-header">
        <h2>Handpicked for You</h2>
    </div>

    <div class="book-grid" id="bookContainer">

        {% for book in books %}
        <div class="book-card"
             data-title="{{ book.title|lower }}"
             data-author="{{ book.author|lower }}"
             data-year="{{ book.year|default('') }}"
             data-publisher="{{ book.publisher|default('')|lower }}">

            <div class="card-media">
                <a href="/book/{{ book.isbn }}">
                    <img src="{{ book.image_url_m }}"
                         onerror="this.src='https://via.placeholder.com/200x300?text=No+Cover'"
                         alt="{{ book.title }}">
                </a>
            </div>

            <div class="card-info">
                <span class="tag">Bestseller</span>

                <h3 class="book-title">
                    <a href="/book/{{ book.isbn }}">
                        {{ book.title }}
                    </a>
                </h3>

                <p class="author">{{ book.author }}</p>

                <div class="price-row">
                    <span class="price">
                        ‚Çπ{{ book.price if book.price else 449 }}
                    </span>

                    <button class="add-btn"
                        onclick="addToCart('{{ book.title|escape }}')">
                        Add +
                    </button>
                </div>
            </div>

        </div>
        {% endfor %}

    </div>
</main>

<!-- ================= FOOTER ================= -->
<footer class="premium-footer">
    <div class="footer-grid">
        <div>
            <h3>‚ú® Book<span>Genie</span></h3>
            <p>Your ultimate reading companion.</p>
        </div>
        <div>
            <h4>Quick Links</h4>
            <a href="#">Best Sellers</a>
            <a href="/privacy">Privacy Policy</a>
        </div>
        <div>
            <h4>Contact</h4>
            <p>support@bookgenie.com</p>
        </div>
    </div>

    <div class="footer-legal">
        ¬© 2026 BookGenie Store
    </div>
</footer>

<!-- ================= AI CHATBOT ================= -->
<div id="chatbot-launcher" class="chatbot-bubble" onclick="toggleChat()">‚ú®</div>

<div id="chatbot-container" class="chatbot-window">

    <div class="chatbot-header">
        <h4>BookGenie AI Assistant</h4>
        <button onclick="toggleChat()">√ó</button>
    </div>

    <div id="chat-body" class="chatbot-body">
        {% if session.get("user") %}
            <div class="message bot">
                Hello {{ session["user"] }} üëã How can I help you today?
            </div>
        {% else %}
            <div class="message bot">
                Hello Guest üëã Ask me anything about books!
            </div>
        {% endif %}
    </div>

    <div class="chatbot-footer">
        <input type="text" id="chatInput"
               placeholder="Ask me anything..."
               onkeypress="if(event.key === 'Enter') sendMessage()">

        <button onclick="sendMessage()">Send</button>
        <button onclick="startVoice()" id="voiceBtn" class="mic-btn">üé§</button>
    </div>

</div>

<!-- ================= SCRIPTS ================= -->
<script src="{{ url_for('static', filename='script.js') }}"></script>

<script>
    // Load cart count on page load
    document.addEventListener("DOMContentLoaded", function() {
        fetch("/api/cart/count")
            .then(res => res.json())
            .then(data => {
                document.getElementById("cartCount").innerText = data.count;
            });
    });

    // Dynamic Filter
    function dynamicFilter() {

        const title = document.getElementById("filterTitle").value.toLowerCase();
        const author = document.getElementById("filterAuthor").value.toLowerCase();
        const year = document.getElementById("filterYear").value.toLowerCase();
        const publisher = document.getElementById("filterPublisher").value.toLowerCase();

        const cards = document.querySelectorAll(".book-card");

        cards.forEach(card => {

            const cTitle = card.dataset.title || "";
            const cAuthor = card.dataset.author || "";
            const cYear = card.dataset.year || "";
            const cPublisher = card.dataset.publisher || "";

            if (
                cTitle.includes(title) &&
                cAuthor.includes(author) &&
                cYear.includes(year) &&
                cPublisher.includes(publisher)
            ) {
                card.style.display = "block";
            } else {
                card.style.display = "none";
            }

        });
    }
</script>

</body>
</html>